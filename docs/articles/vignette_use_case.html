<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Use cases • gcamfaostat</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Use cases">
<meta property="og:description" content="gcamfaostat">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">gcamfaostat</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fas fa-book"></span>
     
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/vignette_getting_started.html">Getting Started</a>
    </li>
    <li>
      <a href="../articles/vignette_preparing_data.html">Preparing Data</a>
    </li>
    <li>
      <a href="../articles/vignette_processing_flow.html">Processing Flow</a>
    </li>
    <li>
      <a href="../articles/vignette_updating_sources.html">Update Sources</a>
    </li>
    <li>
      <a href="../articles/vignette_user_modifications.html">User Modifications</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/vignette_visualization.html">
    <span class="fa fa-file-image-o"></span>
     
    Visualization
  </a>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fa fa-file-code-o"></span>
     
    Reference
  </a>
</li>
<li>
  <a href="../articles/vignette_news.html">
    <span class="fa fa-newspaper-o"></span>
     
    News
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/realxinzhao/gcamfaostat/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Use cases</h1>
            
            <h4 data-toc-skip class="date">2023-10-24</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/realxinzhao/gcamfaostat/blob/HEAD/vignettes/vignette_use_case.Rmd" class="external-link"><code>vignettes/vignette_use_case.Rmd</code></a></small>
      <div class="hidden name"><code>vignette_use_case.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Users may want to change the default gcamdata behavior by either
modifying input assumptions or changing intermediate chunks. They can
now write a “user modification” chunk that can be “plugged in” to the
data system. This new chunk can modify any objects that are used or
created in gcamdata and pass the modified object to all dependent
chunks.</p>
<p>User-modification chunks have a format similar to other data chunks
in gcamdata, except that instead of producing a new output, it returns a
modified data object that replaces the original data object in the data
system. These new chunks can be added to <code><a href="../reference/driver_drake.html">driver_drake()</a></code> or
<code><a href="../reference/driver.html">driver()</a></code> using the new arguments
<code>user_modifications</code> and <code>xml_suffix</code>, which tell
gcamdata which modification function to use and what suffix to add to
all impacted downstream xmls.</p>
</div>
<div class="section level2">
<h2 id="example-modify-shareweight">Example: Modify Shareweight<a class="anchor" aria-label="anchor" href="#example-modify-shareweight"></a>
</h2>
<p>Below we show an example user-modification chunk to change a
shareweight in an input csv file.</p>
<div class="section level3">
<h3 id="user-modification-chunk">User Modification Chunk<a class="anchor" aria-label="anchor" href="#user-modification-chunk"></a>
</h3>
<p>Here we load in two csv files, “energy/A322.subsector_shrwt.csv” and
“common/GCAM_region_names.csv”. We modify A322.subsector_shrwt, so we
list it under <code>driver.DECLARE_MODIFY</code>, but do not modify
GCAM_region_names, so it is listed under
<code>driver.DECLARE_INPUTS</code>. Then, we set the shareweight column
of the first row of A322.subsector_shrwt to <code>NEW.SHWT</code>.
Finally, we use a new <code>return_modified()</code> function to return
the modified A322.subsector_shrwt (note that we have to include the path
for input files).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">usermod_fert</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">command</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">command</span> <span class="op">==</span> <span class="va">driver.DECLARE_MODIFY</span><span class="op">)</span> <span class="op">{</span>
    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>FILE <span class="op">=</span> <span class="st">"energy/A322.subsector_shrwt"</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">command</span> <span class="op">==</span> <span class="va">driver.DECLARE_INPUTS</span><span class="op">)</span> <span class="op">{</span>
    <span class="co"># In addition to the objects users want to modify we can also ask for any other</span>
    <span class="co"># inputs we need to do our operations but won't be modified</span>
    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>FILE <span class="op">=</span> <span class="st">"common/GCAM_region_names"</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">command</span> <span class="op">==</span> <span class="va">driver.MAKE</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">all_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
    <span class="va">GCAM_region_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_data.html">get_data</a></span><span class="op">(</span><span class="va">all_data</span>, <span class="st">"common/GCAM_region_names"</span><span class="op">)</span>
    <span class="va">A322.subsector_shrwt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_data.html">get_data</a></span><span class="op">(</span><span class="va">all_data</span>, <span class="st">"energy/A322.subsector_shrwt"</span><span class="op">)</span>

    <span class="co"># Users could also read in additional files that exist outside of the data system</span>
    <span class="co"># They should do that manually instead of through the driver.DECLARE_INPUTS so as to</span>
    <span class="co"># avoid mixing user's custom files with Core files</span>
    <span class="co"># A23.globaltech_eff.mine &lt;- read_csv("/path/to/my/custom/A23.globaltech_eff_with_random_changes.csv")</span>
    
    <span class="co"># Make some changes...</span>
    <span class="va">A322.subsector_shrwt</span> <span class="op">&lt;-</span> <span class="va">A322.subsector_shrwt</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>share.weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/double.html" class="external-link">as.double</a></span><span class="op">(</span><span class="va">share.weight</span><span class="op">)</span>,
             year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span>
    <span class="va">A322.subsector_shrwt</span><span class="op">[</span><span class="fl">1</span>,<span class="st">"share.weight"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">NEW.SHWT</span>
    
    <span class="co"># NOTE: we have to match the original object name we asked for in driver.DECLARE_MODIFY, </span>
    <span class="co"># which means including the file path for input files</span>
    <span class="co"># i.e. "energy/A322.subsector_shrwt" not "A322.subsector_shrwt"  </span>
    <span class="co"># Other objects can be listed out just like for `return_data`</span>
    <span class="fu">return_modified</span><span class="op">(</span><span class="st">"energy/A322.subsector_shrwt"</span> <span class="op">=</span> <span class="va">A322.subsector_shrwt</span><span class="op">)</span>

  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Unknown command"</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="run-usermod_fert-once">Run usermod_fert once<a class="anchor" aria-label="anchor" href="#run-usermod_fert-once"></a>
</h3>
<p>To include our modification, we include this new chunk in our call to
<code><a href="../reference/driver_drake.html">driver_drake()</a></code> and also include a suffix to append to any
affected objects (currently mandatory to include suffix).</p>
<p>Because we used the constant <code>NEW.SHWT</code> to assign the new
value in our function, we first need to set it here.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">NEW.SHWT</span> <span class="op">&lt;-</span> <span class="fl">0.5</span>

<span class="fu"><a href="../reference/driver_drake.html">driver_drake</a></span><span class="op">(</span>user_modifications <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"usermod_fert"</span><span class="op">)</span>,
        xml_suffix <span class="op">=</span> <span class="st">"__1"</span><span class="op">)</span> <span class="co"># output xml will be saved as ORIGINALNAME_001.xml</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="run-usermod_fert-multiple-times">Run usermod_fert multiple times<a class="anchor" aria-label="anchor" href="#run-usermod_fert-multiple-times"></a>
</h3>
<p>We can also generate multiple modified xmls using
<code><a href="../reference/driver_drake.html">driver_drake()</a></code>. To do this, we simply need to change the
value of <code>NEW.SHWT</code> and ensure that each different value is
associated with a different <code>xml_suffix</code>. As well, we need to
clear the usermod_fert object from drake’s cache using
<code><a href="https://docs.ropensci.org/drake/reference/clean.html" class="external-link">drake::clean()</a></code> as drake is not aware of the change to
<code>NEW.SHWT</code>. If you do not include this call, drake may assume
that all downstream objects/xmls do not need to be updated.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Xin Zhao, Maksym Chepeliev, Pralit Patel, Marshall Wise, Kanishka Narayan, Chris Vernon.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
