<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Visualization • gcamfaostat</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Visualization">
<meta property="og:description" content="gcamfaostat">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">gcamfaostat</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fas fa-book"></span>
     
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/vignette_getting_started.html">Getting Started</a>
    </li>
    <li>
      <a href="../articles/vignette_preparing_data.html">Preparing Data</a>
    </li>
    <li>
      <a href="../articles/vignette_processing_flow.html">Processing Flow</a>
    </li>
    <li>
      <a href="../articles/vignette_use_cases.html">Use Cases</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/vignette_visualization.html">
    <span class="fa fa-file-image-o"></span>
     
    Visualization
  </a>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fa fa-file-code-o"></span>
     
    Reference
  </a>
</li>
<li>
  <a href="../articles/vignette_news.html">
    <span class="fa fa-newspaper-o"></span>
     
    News
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jgcri/gcamfaostat/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Visualization</h1>
            
            <h4 data-toc-skip class="date">2024-02-11</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/jgcri/gcamfaostat/blob/HEAD/vignettes/vignette_visualization.Rmd" class="external-link"><code>vignettes/vignette_visualization.Rmd</code></a></small>
      <div class="hidden name"><code>vignette_visualization.Rmd</code></div>

    </div>

    
    
<p><strong>Here we visualize the processed data to illustrate the
connection of harvested area and food calories via supply utilization
accounts.</strong><br>
* We focus on the 2013 - 2017 mean as they are the base calibration
years of GCAM. * A user can change the years and mappings as desired. *
All the data used are from <code>gcamfaostat</code>.<br>
* Code for generating the figures are provided in the bottom.<br>
* The visualization here will be continuously updates (suggestions and
pull requests welcome).<br>
* Chord diagram for trade and food processing nests will be added
later.<br>
* We will also try using shiny apps to make them interactive.</p>
<hr>
<div class="section level2">
<h2 id="population">Population<a class="anchor" aria-label="anchor" href="#population"></a>
</h2>
<div class="figure">
<img src="../reference/figures/Fig_WorldPopulation.png" style="width:100.0%" alt=""><p class="caption">Wrold population was around 7.4 billion in 2013 -
2017. It has increased to 7.8 billion in 2020 and reached 8 billion in
mid-Nov 2022. In 2020, the most populous regions are China (14.4 B),
India (13.8 B), USA (3.3 B), Indonesia (2.7 B), Pakistan (2.2 B), Brazil
(2.13 B), Nigeria (2.06 B), Bangladesh (1.65 B), Russian Federation
(1.46 B) and Mexico (1.3 B).</p>
</div>
<hr>
</div>
<div class="section level2">
<h2 id="harvested-area">Harvested area<a class="anchor" aria-label="anchor" href="#harvested-area"></a>
</h2>
<p><img src="../reference/figures/Fig_WorldAreaHarvested.png" style="width:100.0%"> World area harvested (shares) grouped by GCAM
crops based on the 2013 – 2017 mean values. The total harvested area is
1509 million hectares (Mha).</p>
<p><img src="../reference/figures/Fig_WorldAreaHarvestedReg.png" style="width:100.0%"> Food calories availability per capita per day
grouped by GCAM regions and commodities based on the 2013 – 2017 mean
values. The world average value is 2902 Kcal per capita per day
(Kcal/ca/d).</p>
<hr>
</div>
<div class="section level2">
<h2 id="yield-growth">Yield growth<a class="anchor" aria-label="anchor" href="#yield-growth"></a>
</h2>
<div class="figure">
<img src="../reference/figures/Fig_WorldYield.png" style="width:100.0%" alt=""><p class="caption">Surprisingly, oil palm fruit yield did not grow at
regional levels (boxplot) in the past 30 years. But world yield
increased by ~50% due to the production shift to high-yielding regions.
The opposite is true for root and tuber crops</p>
</div>
<hr>
</div>
<div class="section level2">
<h2 id="supply-utilization">Supply-utilization<a class="anchor" aria-label="anchor" href="#supply-utilization"></a>
</h2>
<p><img src="../reference/figures/Fig_WorldSUA.png" style="width:100.0%">
World supply utilization accounts for key commodities based on the 2013
– 2017 mean values. Note that negative values are used for demand
categories and positive values are used for supply categories. Other
uses include seed use, losses, and industrial use; residuals (mostly
small) indicate the imbalance in the data, mainly implying the quality
of the source data. The total supply is equal to the total demand.</p>
<hr>
</div>
<div class="section level2">
<h2 id="food-calories">Food Calories<a class="anchor" aria-label="anchor" href="#food-calories"></a>
</h2>
<p><img src="../reference/figures/Fig_WorldFoodCalories.png" style="width:100.0%"><img src="../reference/figures/Fig_WorldFoodCaloriesReg.png" style="width:100.0%"><img src="../reference/figures/Fig_WorldFoodCaloriesRegPcPerDay.png" style="width:100.0%" alt="Per capita food availability is highly heterogeneous across regions and commodities"></p>
<hr>
</div>
<div class="section level2">
<h2 id="trade-flows">Trade flows<a class="anchor" aria-label="anchor" href="#trade-flows"></a>
</h2>
<div class="figure">
<img src="../reference/figures/Fig_WheatTrade2021.png" style="width:100.0%" alt=""><p class="caption">World bilateral trade flow in 2021. The world total
trade was 199 million tonnes.</p>
</div>
<hr>
</div>
<div class="section level2">
<h2 id="code-for-generating-figures">Code for generating figures<a class="anchor" aria-label="anchor" href="#code-for-generating-figures"></a>
</h2>
<div class="section level3">
<h3 id="load-package-data">0. Load package data<a class="anchor" aria-label="anchor" href="#load-package-data"></a>
</h3>
<ul>
<li>Load gcamfaostat locally, assuming driver_drake() was run so that
data can be loaded from cache.</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">load_all</span><span class="op">(</span><span class="op">)</span> </span>
<span><span class="co"># Load other libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">treemap</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">RColorBrewer</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Define input data needed ----</span></span>
<span><span class="va">MODULE_INPUTS</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>FILE <span class="op">=</span> <span class="st">"aglu/FAO/FAO_ag_items_PRODSTAT"</span>,</span>
<span>    FILE <span class="op">=</span> <span class="st">"common/GCAM_region_names"</span>,</span>
<span>    FILE <span class="op">=</span> <span class="st">"common/iso_GCAM_regID"</span>,</span>
<span>    FILE <span class="op">=</span> <span class="st">"aglu/AGLU_ctry"</span>,</span>
<span>    <span class="st">"FAO_Food_Macronutrient_All_2010_2019"</span>,</span>
<span>    <span class="st">"QCL_CROP_PRIMARY"</span>,</span>
<span>    <span class="st">"QCL_FODDERCROP"</span>,</span>
<span>    <span class="st">"Bal_new_all"</span>,</span>
<span>    <span class="st">"OA"</span><span class="op">)</span></span></code></pre></div>
<ul>
<li>To get more information of the input data and trace their use in the
package, use <code>info</code> or <code>dstrace</code> function. They
are functions inherited from <code>gcamdata</code> for tracing data
processing flows.</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># For example</span></span>
<span><span class="fu"><a href="../reference/info.html">info</a></span><span class="op">(</span><span class="st">"QCL_CROP_PRIMARY"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/dstrace.html">dstrace</a></span><span class="op">(</span><span class="st">"common/iso_GCAM_regID"</span><span class="op">)</span></span></code></pre></div>
<ul>
<li>Load the data defined in <code>MODULE_INPUTS</code> from drake
cache</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load the data to all_data as a list</span></span>
<span><span class="va">MODULE_INPUTS</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/load_from_cache.html">load_from_cache</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">all_data</span></span>
<span><span class="co"># Assign the data items to their names as data frames</span></span>
<span><span class="fu"><a href="../reference/get_data_list.html">get_data_list</a></span><span class="op">(</span><span class="va">all_data</span>, <span class="va">MODULE_INPUTS</span>, strip_attributes <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<ul>
<li>Define a base year period for visualizing cross-sectional data. The
mean value will be used. Note that 2013-2017 is used here since 2015 is
the <em>GCAM v7</em> base year. However, this can be changed to other
year(s)</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">BaseYear</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2013</span><span class="op">:</span><span class="fl">2017</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="population-1">1. Population<a class="anchor" aria-label="anchor" href="#population-1"></a>
</h3>
<ul>
<li>Get data ready</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># simplify population data</span></span>
<span><span class="va">OA</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">element_code</span> <span class="op">==</span> <span class="fl">511</span>, <span class="va">item_code</span> <span class="op">==</span> <span class="fl">3010</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/transmute.html" class="external-link">transmute</a></span><span class="op">(</span><span class="va">area</span>, <span class="va">area_code</span>, <span class="va">year</span>, value <span class="op">=</span> <span class="va">value</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">BaseYear</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">BaseYear</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">gcamdata</span><span class="fu">::</span><span class="fu">left_join_error_no_match</span><span class="op">(</span><span class="va">AGLU_ctry</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span>area <span class="op">=</span> <span class="va">FAO_country</span>, <span class="va">iso</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"area"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">gcamdata</span><span class="fu">::</span><span class="fu">left_join_error_no_match</span><span class="op">(</span><span class="va">iso_GCAM_regID</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">iso</span>, <span class="va">GCAM_region_ID</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"iso"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">GCAM_region_names</span>, by <span class="op">=</span> <span class="st">"GCAM_region_ID"</span><span class="op">)</span> <span class="op">-&gt;</span> </span>
<span>  <span class="va">POP</span> <span class="co">#1000 persons</span></span></code></pre></div>
<ul>
<li>Plot and save</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Figure title</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"World population grouped by GCAM 32 regions, "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">BaseYear</span><span class="op">)</span>, <span class="st">"-"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">BaseYear</span><span class="op">)</span>, <span class="st">" mean ("</span>,</span>
<span>       <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">POP</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op">/</span> <span class="fl">1000000</span><span class="op">)</span>,<span class="fl">1</span><span class="op">)</span>, <span class="st">" Billion)"</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">title</span></span>
<span></span>
<span><span class="fu"><a href="../reference/treemap_wrapper.html">treemap_wrapper</a></span><span class="op">(</span></span>
<span>  .DF <span class="op">=</span> <span class="va">POP</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">region</span>, <span class="va">area</span>, <span class="va">value</span><span class="op">)</span>, </span>
<span>  .Depth <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  .Palette <span class="op">=</span> <span class="st">"YlOrRd"</span>, .LastLabelCol <span class="op">=</span> <span class="st">"blue"</span>,</span>
<span>  .FigTitle <span class="op">=</span> <span class="va">title</span>, .FigTitleSize <span class="op">=</span> <span class="fl">16</span>, </span>
<span>  .SaveName <span class="op">=</span> <span class="st">"Fig_WorldPopulation"</span>, </span>
<span>  .SaveScaler <span class="op">=</span> <span class="fl">1.2</span></span>
<span><span class="op">)</span></span></code></pre></div>
<ul>
<li>Preview<br><img src="../reference/figures/Fig_WorldPopulation.png" style="width:20.0%" alt="Population">
</li>
</ul>
</div>
<div class="section level3">
<h3 id="harvested-area-1">2. Harvested area<a class="anchor" aria-label="anchor" href="#harvested-area-1"></a>
</h3>
<ul>
<li>Get data ready</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">QCL_CROP_PRIMARY</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">QCL_FODDERCROP</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">BaseYear</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">element</span> <span class="op">==</span> <span class="st">"Area harvested"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="co"># Change to Mha</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>value <span class="op">=</span> <span class="va">value</span> <span class="op">/</span> <span class="fl">1000000</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">unit</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># the iso mapping in AGLU_ctry works good now</span></span>
<span>  <span class="fu">gcamdata</span><span class="fu">::</span><span class="fu">left_join_error_no_match</span><span class="op">(</span><span class="va">AGLU_ctry</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span>area <span class="op">=</span> <span class="va">FAO_country</span>, <span class="va">iso</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"area"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">gcamdata</span><span class="fu">::</span><span class="fu">left_join_error_no_match</span><span class="op">(</span><span class="va">iso_GCAM_regID</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">iso</span>, <span class="va">GCAM_region_ID</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"iso"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">GCAM_region_names</span>, by <span class="op">=</span> <span class="st">"GCAM_region_ID"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">region</span>, <span class="va">item_code</span>, <span class="va">item</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="co"># 5-year average</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">BaseYear</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span></span>
<span>    <span class="va">FAO_ag_items_PRODSTAT</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">item</span><span class="op">)</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">GCAM_commodity</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">item_code</span>, <span class="va">GCAM_subsector</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"item_code"</span><span class="op">)</span> <span class="op">-&gt;</span></span>
<span>  <span class="va">Tree_Area_Reg_Sector</span></span></code></pre></div>
<ul>
<li>Plot and save</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"World area harvested grouped by GCAM crops, "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">BaseYear</span><span class="op">)</span>, <span class="st">"-"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">BaseYear</span><span class="op">)</span>, <span class="st">" mean ("</span>,</span>
<span>       <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">Tree_Area_Reg_Sector</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op">)</span>,<span class="fl">0</span><span class="op">)</span>, <span class="st">" Mha)"</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">title</span></span>
<span></span>
<span><span class="fu"><a href="../reference/treemap_wrapper.html">treemap_wrapper</a></span><span class="op">(</span></span>
<span>  .DF <span class="op">=</span> <span class="va">Tree_Area_Reg_Sector</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">GCAM_subsector</span>, <span class="va">item</span>, <span class="va">value</span><span class="op">)</span>, </span>
<span>  .Depth <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  .Palette <span class="op">=</span> <span class="st">"Set2"</span>,</span>
<span>  .FigTitle <span class="op">=</span> <span class="va">title</span>, .FigTitleSize <span class="op">=</span> <span class="fl">16</span>, </span>
<span>  .SaveName <span class="op">=</span> <span class="st">"Fig_WorldAreaHarvested"</span>, </span>
<span>  .SaveScaler <span class="op">=</span> <span class="fl">1.1</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"World area harvested grouped by GCAM crops and regions, "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">BaseYear</span><span class="op">)</span>, <span class="st">"-"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">BaseYear</span><span class="op">)</span>, <span class="st">" mean ("</span>,</span>
<span>       <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">Tree_Area_Reg_Sector</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op">)</span>,<span class="fl">0</span><span class="op">)</span>, <span class="st">" Mha)"</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">title</span></span>
<span></span>
<span><span class="fu"><a href="../reference/treemap_wrapper.html">treemap_wrapper</a></span><span class="op">(</span></span>
<span>  .DF <span class="op">=</span> <span class="va">Tree_Area_Reg_Sector</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">region</span>, <span class="va">GCAM_subsector</span>, <span class="va">item</span>, <span class="va">value</span><span class="op">)</span>, </span>
<span>  .Depth <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  .Palette <span class="op">=</span> <span class="st">"Set2"</span>,</span>
<span>  .FigTitle <span class="op">=</span> <span class="va">title</span>, .FigTitleSize <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  .SaveName <span class="op">=</span> <span class="st">"Fig_WorldAreaHarvestedReg"</span>, </span>
<span>  .SaveScaler <span class="op">=</span> <span class="fl">1.6</span></span>
<span><span class="op">)</span></span></code></pre></div>
<ul>
<li>Preview<br><img src="../reference/figures/Fig_WorldAreaHarvested.png" style="width:20.0%"><img src="../reference/figures/Fig_WorldAreaHarvestedReg.png" style="width:20.0%">
</li>
</ul>
</div>
<div class="section level3">
<h3 id="yield">3. Yield<a class="anchor" aria-label="anchor" href="#yield"></a>
</h3>
<ul>
<li>Get data ready</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">YieldBaseYear</span> <span class="op">=</span> <span class="fl">1990</span></span>
<span><span class="va">QCL_CROP_PRIMARY</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="co"># disaggregate dissolved regions in history</span></span>
<span>  <span class="fu"><a href="../reference/FAO_AREA_DISAGGREGATE_HIST_DISSOLUTION_ALL.html">FAO_AREA_DISAGGREGATE_HIST_DISSOLUTION_ALL</a></span><span class="op">(</span>SUDAN2012_MERGE <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="co"># the iso mapping in AGLU_ctry works good now</span></span>
<span>  <span class="fu"><a href="../reference/left_join_error_no_match.html">left_join_error_no_match</a></span><span class="op">(</span><span class="va">AGLU_ctry</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span>area <span class="op">=</span> <span class="va">FAO_country</span>, <span class="va">iso</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"area"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/left_join_error_no_match.html">left_join_error_no_match</a></span><span class="op">(</span><span class="va">iso_GCAM_regID</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">iso</span>, <span class="va">GCAM_region_ID</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"iso"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">GCAM_region_names</span>, by <span class="op">=</span> <span class="st">"GCAM_region_ID"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">GCAM_region_ID</span>, <span class="va">region</span>, <span class="va">element</span>, <span class="va">unit</span>, <span class="va">year</span>, <span class="va">item_code</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="co"># aggregate to 32 GCAM regions</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span></span>
<span>    <span class="va">FAO_ag_items_PRODSTAT</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">item</span><span class="op">)</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">GCAM_commodity</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">item_code</span>, <span class="va">GCAM_subsector</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"item_code"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by_all.html" class="external-link">group_by_at</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">GCAM_region_ID</span>, <span class="va">region</span>, <span class="va">GCAM_subsector</span>, <span class="va">year</span>, <span class="va">element</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="co"># Aggregate to GCAM sectors</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">YieldBaseYear</span>, <span class="fl">2020</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">spread</span><span class="op">(</span><span class="va">element</span>, <span class="va">value</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">`Area harvested`</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># Calculate regio-sector yield</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Yield <span class="op">=</span> <span class="va">Production</span> <span class="op">/</span> <span class="va">`Area harvested`</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">gather</span><span class="op">(</span><span class="va">element</span>, <span class="va">value</span>, <span class="va">`Area harvested`</span>, <span class="va">Production</span>,  <span class="va">Yield</span><span class="op">)</span> <span class="op">-&gt;</span></span>
<span>  <span class="va">Yield_1990_2020_GCAMRegSector</span></span>
<span></span>
<span><span class="va">Yield_1990_2020_GCAMRegSector</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">element</span> <span class="op">==</span> <span class="st">"Yield"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by_all.html" class="external-link">group_by_at</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="op">-</span><span class="va">year</span>, <span class="op">-</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># Calculate growth rate</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>value <span class="op">=</span> <span class="va">value</span> <span class="op">/</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html" class="external-link">first</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">!=</span> <span class="va">YieldBaseYear</span><span class="op">)</span> <span class="op">-&gt;</span></span>
<span>  <span class="va">Yield_1990_2020_GCAMRegSector_Growth</span></span>
<span></span>
<span><span class="va">Yield_1990_2020_GCAMRegSector_Growth</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="co"># Join area to get weight</span></span>
<span>  <span class="fu"><a href="../reference/left_join_error_no_match.html">left_join_error_no_match</a></span><span class="op">(</span><span class="va">Yield_1990_2020_GCAMRegSector</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                             <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">element</span> <span class="op">==</span> <span class="st">"Area harvested"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">spread</span><span class="op">(</span><span class="va">element</span>, <span class="va">value</span><span class="op">)</span>, </span>
<span>                           by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"GCAM_region_ID"</span>, <span class="st">"region"</span>, <span class="st">"GCAM_subsector"</span>, <span class="st">"year"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by_all.html" class="external-link">group_by_at</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">GCAM_subsector</span>, <span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/weighted.mean.html" class="external-link">weighted.mean</a></span><span class="op">(</span><span class="va">value</span>, w <span class="op">=</span> <span class="va">`Area harvested`</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span><span class="op">-&gt;</span> </span>
<span>  <span class="va">Yield_1990_2020_WorldGCAMSector_Growth_FixdArea</span></span>
<span></span>
<span><span class="va">Yield_1990_2020_GCAMRegSector</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">spread</span><span class="op">(</span><span class="va">element</span>, <span class="va">value</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by_all.html" class="external-link">group_by_at</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">GCAM_subsector</span>, <span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>Production <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Production</span><span class="op">)</span>,</span>
<span>         `Area harvested` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">`Area harvested`</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Yield <span class="op">=</span> <span class="va">Production</span> <span class="op">/</span> <span class="va">`Area harvested`</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">gather</span><span class="op">(</span><span class="va">element</span>, <span class="va">value</span>, <span class="va">`Area harvested`</span>, <span class="va">Production</span>,  <span class="va">Yield</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">element</span> <span class="op">==</span> <span class="st">"Yield"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by_all.html" class="external-link">group_by_at</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="op">-</span><span class="va">year</span>, <span class="op">-</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>value <span class="op">=</span> <span class="va">value</span> <span class="op">/</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html" class="external-link">first</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">!=</span> <span class="va">YieldBaseYear</span><span class="op">)</span> <span class="op">-&gt;</span></span>
<span>  <span class="va">Yield_1990_2020_WorldGCAMSector_Growth_ChangingArea</span></span>
<span></span>
<span><span class="co"># Order sectors</span></span>
<span><span class="va">Yield_1990_2020_WorldGCAMSector_Growth_ChangingArea</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="va">value</span><span class="op">)</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">GCAM_subsector</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">SectorRank</span></span></code></pre></div>
<ul>
<li>Plot and save</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Yield_1990_2020_GCAMRegSector_Growth</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>GCAM_subsector <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">GCAM_subsector</span>, levels <span class="op">=</span> <span class="va">SectorRank</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">GCAM_subsector</span>, y <span class="op">=</span> <span class="va">value</span>, fill <span class="op">=</span> <span class="va">GCAM_subsector</span><span class="op">)</span>, outlier.size <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">Yield_1990_2020_WorldGCAMSector_Growth_ChangingArea</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>              <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>GCAM_subsector <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">GCAM_subsector</span>, levels <span class="op">=</span> <span class="va">SectorRank</span><span class="op">)</span><span class="op">)</span>,</span>
<span>             <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">GCAM_subsector</span>, y <span class="op">=</span> <span class="va">value</span>, group <span class="op">=</span> <span class="va">year</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"blue"</span>, size <span class="op">=</span> <span class="fl">1.6</span>, alpha <span class="op">=</span> <span class="fl">0.9</span> <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">Yield_1990_2020_WorldGCAMSector_Growth_FixdArea</span>,</span>
<span>             <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">GCAM_subsector</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">2.5</span>, shape <span class="op">=</span> <span class="fl">21</span>, color <span class="op">=</span> <span class="st">"black"</span> <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">3.3</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"1990 = 1"</span>, x <span class="op">=</span> <span class="st">"GCAM Crop Sector"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Yield change in 1990 - 2020, distribution (Tukey style) across GCAM regions."</span>, </span>
<span>       subtitle <span class="op">=</span> <span class="st">"World mean growth (blue line) vs. weighted mean of regional growth (red dots)"</span>,</span>
<span>       caption <span class="op">=</span> <span class="st">"Data: FAOSTAT \n Package: JGCRI/gcamfaostat"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span>,</span>
<span>        axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span>,</span>
<span>        axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">40</span>, hjust <span class="op">=</span> <span class="fl">1</span>, vjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>        strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"grey90"</span><span class="op">)</span>,</span>
<span>        legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">p</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"../man/figures"</span>, <span class="st">"WorldYield.png"</span><span class="op">)</span>, <span class="va">p</span>, width <span class="op">=</span> <span class="fl">15</span>, height <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<ul>
<li>Preview<br><img src="../reference/figures/Fig_WorldYield.png" style="width:20.0%">
</li>
</ul>
</div>
<div class="section level3">
<h3 id="supply-utilization-1">4. Supply-utilization<a class="anchor" aria-label="anchor" href="#supply-utilization-1"></a>
</h3>
<ul>
<li>Get data ready</li>
</ul>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define elements and items</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Opening stocks"</span>, <span class="st">"Import"</span>, <span class="st">"Production"</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">ElEMSupply</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Food"</span>, <span class="st">"Feed"</span>,  <span class="st">"Processed"</span>, <span class="st">"Other uses"</span>, <span class="st">"Export"</span>, <span class="st">"Closing stocks"</span>, <span class="st">"Residuals"</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">ELEMDemand</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">ElEMSupply</span>, <span class="va">ELEMDemand</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">ELEMAll</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">ElEMSupply</span>, <span class="va">ELEMDemand</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">rev</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">ELEMLevel</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Supply: "</span>, <span class="va">ElEMSupply</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Demand: "</span>, <span class="va">ELEMDemand</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">rev</span> <span class="op">)</span> <span class="op">-&gt;</span> <span class="va">ELEMLabel</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Maize"</span>, <span class="st">"Wheat"</span>, <span class="st">"Rice, paddy"</span>, <span class="st">"Soybeans"</span>, <span class="st">"Potatoes"</span>, <span class="st">"Oil palm fruit"</span>, <span class="st">"Bananas"</span>, <span class="st">"Avocados"</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">KeySectorCrops</span></span>
<span></span>
<span><span class="co"># These are items from FAO </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Meat, pig"</span>, <span class="st">"Meat, chicken"</span>, <span class="st">"Eggs, hen, in shell"</span>, <span class="st">"Meat, cattle"</span>, </span>
<span>  <span class="st">"Pelagic Fish"</span>, <span class="st">"Freshwater Fish"</span> , <span class="st">"Meat, sheep"</span>, <span class="st">"Meat, goat"</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">KeySectorMeat</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">KeySectorCrops</span>, <span class="va">KeySectorMeat</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">SECLevel</span></span>
<span></span>
<span><span class="co"># Define color pal.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html" class="external-link">brewer.pal</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ELEMAll</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"Spectral"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ElEMSupply</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html" class="external-link">brewer.pal</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ELEMAll</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"Spectral"</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ElEMSupply</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ELEMDemand</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">ColUpdate</span></span>
<span></span>
<span></span>
<span><span class="va">Bal_new_all</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">BaseYear</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># Aggregate seed and loss into others</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>element <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/replace.html" class="external-link">replace</a></span><span class="op">(</span><span class="va">element</span>, <span class="va">element</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Seed"</span>, <span class="st">"Loss"</span><span class="op">)</span>, <span class="st">"Other uses"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by_all.html" class="external-link">group_by_at</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="op">-</span><span class="va">value</span>, <span class="op">-</span><span class="va">area_code</span>, <span class="op">-</span><span class="va">area</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op">/</span> <span class="fl">1000</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">element</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">ELEMAll</span>, <span class="va">item</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">SECLevel</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="co"># year-average</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by_all.html" class="external-link">group_by_at</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="op">-</span><span class="va">value</span>, <span class="op">-</span><span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>value <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="op">!</span><span class="va">element</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">ElEMSupply</span>, <span class="op">-</span><span class="va">value</span>, <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>element <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">element</span>, levels <span class="op">=</span> <span class="va">ELEMLevel</span>, labels <span class="op">=</span> <span class="va">ELEMLabel</span><span class="op">)</span>,</span>
<span>         item <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">item</span>, levels <span class="op">=</span> <span class="va">SECLevel</span>, labels <span class="op">=</span> <span class="va">SECLevel</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>CropMeat <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">item</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">KeySectorCrops</span>, <span class="st">"Crop"</span>, <span class="st">"Meat"</span><span class="op">)</span><span class="op">)</span> <span class="op">-&gt;</span></span>
<span>  <span class="va">DF_SUA</span></span></code></pre></div>
<ul>
<li>Plot and save</li>
</ul>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DF_SUA</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">CropMeat</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">item</span>, y <span class="op">=</span> <span class="va">value</span>, fill <span class="op">=</span> <span class="va">element</span><span class="op">)</span>,</span>
<span>             stat <span class="op">=</span> <span class="st">"identity"</span>, color <span class="op">=</span> <span class="st">"black"</span>, position<span class="op">=</span><span class="st">"stack"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Supply: Opening stocks"</span> <span class="op">=</span> <span class="va">ColUpdate</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, </span>
<span>                               <span class="st">"Supply: Import"</span> <span class="op">=</span> <span class="va">ColUpdate</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, </span>
<span>                               <span class="st">"Supply: Production"</span> <span class="op">=</span> <span class="va">ColUpdate</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>,</span>
<span>                               <span class="st">"Demand: Food"</span> <span class="op">=</span> <span class="va">ColUpdate</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>,</span>
<span>                               <span class="st">"Demand: Feed"</span> <span class="op">=</span> <span class="va">ColUpdate</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span>, </span>
<span>                               <span class="st">"Demand: Processed"</span> <span class="op">=</span> <span class="va">ColUpdate</span><span class="op">[</span><span class="fl">6</span><span class="op">]</span>,</span>
<span>                               <span class="st">"Demand: Other uses"</span> <span class="op">=</span> <span class="va">ColUpdate</span><span class="op">[</span><span class="fl">7</span><span class="op">]</span>,</span>
<span>                               <span class="st">"Demand: Residuals"</span> <span class="op">=</span> <span class="va">ColUpdate</span><span class="op">[</span><span class="fl">8</span><span class="op">]</span>,</span>
<span>                               <span class="st">"Demand: Export"</span> <span class="op">=</span> <span class="va">ColUpdate</span><span class="op">[</span><span class="fl">9</span><span class="op">]</span>,</span>
<span>                               <span class="st">"Demand: Closing stocks"</span> <span class="op">=</span> <span class="va">ColUpdate</span><span class="op">[</span><span class="fl">10</span><span class="op">]</span> <span class="op">)</span> <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Key agriculture Commodities"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Million tonnes"</span>, fill <span class="op">=</span> <span class="st">"Element"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"World supply utilization for key commodities, 2013 - 2017 mean"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Other uses include seed use, losses, and industrial use"</span>,</span>
<span>       caption <span class="op">=</span> <span class="st">"Data: FAOSTAT \n Package: JGCRI/gcamfaostat"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span>,</span>
<span>        axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span>,</span>
<span>        axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">35</span>, hjust <span class="op">=</span> <span class="fl">1</span>, vjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>        strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"grey100"</span><span class="op">)</span>,</span>
<span>        strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">p</span>;<span class="va">p</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"../man/figures"</span>, <span class="st">"Fig_WorldSUA.png"</span><span class="op">)</span>, <span class="va">p</span>, width <span class="op">=</span> <span class="fl">16</span>, height <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<ul>
<li>Preview<br><img src="../reference/figures/Fig_WorldSUA.png" style="width:20.0%">
</li>
</ul>
</div>
<div class="section level3">
<h3 id="food-calories-1">5. Food calories<a class="anchor" aria-label="anchor" href="#food-calories-1"></a>
</h3>
<ul>
<li>Get data ready</li>
</ul>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">FAO_Food_Macronutrient_All_2010_2019</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">BaseYear</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># Aggregate to region and GCAM commodity</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by_all.html" class="external-link">group_by_at</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">GCAM_region_ID</span>, <span class="va">GCAM_commodity</span>, <span class="va">year</span>, <span class="va">macronutrient</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># Mean over aglu.MODEL_MACRONUTRIENT_YEARS</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by_all.html" class="external-link">group_by_at</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="op">-</span><span class="va">year</span>, <span class="op">-</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">spread</span><span class="op">(</span><span class="va">macronutrient</span>, <span class="va">value</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/left_join_error_no_match.html">left_join_error_no_match</a></span><span class="op">(</span></span>
<span>    <span class="va">POP</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">GCAM_region_ID</span>, <span class="va">region</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>POP <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">/</span><span class="fl">1000</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span>, <span class="co"># Million</span></span>
<span>    by <span class="op">=</span> <span class="st">"GCAM_region_ID"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># Grouping</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>MeatCrop <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">GCAM_commodity</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span></span>
<span>                              <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Beef"</span>, <span class="st">"SheepGoat"</span>, <span class="st">"Dairy"</span>, <span class="st">"OtherMeat_Fish"</span>, <span class="st">"Pork"</span>, <span class="st">"Poultry"</span><span class="op">)</span>, <span class="st">"Meat"</span>, <span class="st">"Crop"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Food <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">GCAM_commodity</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span></span>
<span>                          <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Beef"</span>, <span class="st">"SheepGoat"</span><span class="op">)</span>, <span class="st">"Ruminant"</span>, <span class="st">"Crops"</span><span class="op">)</span>,</span>
<span>         Food <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">GCAM_commodity</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"OtherMeat_Fish"</span>, <span class="st">"Pork"</span>, <span class="st">"Poultry"</span><span class="op">)</span>,</span>
<span>                        <span class="st">"Non-ruminant"</span>, <span class="va">Food</span><span class="op">)</span>,</span>
<span>         Food <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">GCAM_commodity</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Dairy"</span><span class="op">)</span>,</span>
<span>                        <span class="st">"Dairy"</span>, <span class="va">Food</span><span class="op">)</span>,</span>
<span>         Food <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">GCAM_commodity</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"NEC"</span>, <span class="st">"Other processed"</span>, <span class="va">Food</span><span class="op">)</span>,</span>
<span>         Food <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">GCAM_commodity</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"OilCrop"</span>, <span class="st">"Soybean"</span>, <span class="st">"OilPalm"</span>,  <span class="st">"FiberCrop"</span><span class="op">)</span>, <span class="st">"Oilseed"</span>, <span class="va">Food</span><span class="op">)</span>,</span>
<span>         Food <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">GCAM_commodity</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Corn"</span>, <span class="st">"Wheat"</span>, <span class="st">"Rice"</span>, <span class="st">"OtherGrain"</span><span class="op">)</span>, <span class="st">"Cereal grains"</span>, <span class="va">Food</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>PcPdKcal <span class="op">=</span> <span class="va">MKcal</span> <span class="op">/</span> <span class="va">POP</span> <span class="op">/</span> <span class="fl">365</span><span class="op">)</span> <span class="op">-&gt;</span></span>
<span>  <span class="va">DF_Macronutrient_FoodItem</span></span></code></pre></div>
<ul>
<li>Plot and save</li>
</ul>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DF_Macronutrient_FoodItem</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>PKcal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">MKcal</span><span class="op">)</span><span class="op">/</span><span class="fl">10</span><span class="op">^</span><span class="fl">9</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">POP</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>BPOP <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op">/</span> <span class="fl">1000000</span><span class="op">)</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>PcPdKcal <span class="op">=</span> <span class="va">PKcal</span> <span class="op">/</span> <span class="va">BPOP</span> <span class="op">/</span> <span class="fl">365</span> <span class="op">*</span> <span class="fl">1000000</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">WorldSTAT</span></span>
<span></span>
<span><span class="co"># World level by commodity</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"World food calories availability, "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">BaseYear</span><span class="op">)</span>, <span class="st">"-"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">BaseYear</span><span class="op">)</span>, <span class="st">" mean ("</span>,</span>
<span>       <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">WorldSTAT</span><span class="op">$</span><span class="va">PKcal</span>,<span class="fl">2</span><span class="op">)</span>, <span class="st">" Peta-Kcal or "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">WorldSTAT</span><span class="op">$</span><span class="va">PcPdKcal</span>, <span class="fl">0</span><span class="op">)</span>,<span class="st">" Kcal/ca/d)"</span><span class="op">)</span> <span class="op">-&gt;</span></span>
<span>  <span class="va">title</span></span>
<span><span class="fu"><a href="../reference/treemap_wrapper.html">treemap_wrapper</a></span><span class="op">(</span></span>
<span>  .DF <span class="op">=</span> <span class="va">DF_Macronutrient_FoodItem</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Food</span>, <span class="va">GCAM_commodity</span>, value <span class="op">=</span> <span class="va">MKcal</span><span class="op">)</span>,</span>
<span>  .Depth <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  .FigTitle <span class="op">=</span> <span class="va">title</span>, .FigTitleSize <span class="op">=</span> <span class="fl">14</span>,</span>
<span>  .SaveName <span class="op">=</span> <span class="st">"Fig_WorldFoodCalories"</span>,</span>
<span>  .SaveScaler <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># By commodity and region</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"World food calories availability by region and commodity, "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">BaseYear</span><span class="op">)</span>, <span class="st">"-"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">BaseYear</span><span class="op">)</span>, <span class="st">" mean ("</span>,</span>
<span>       <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">WorldSTAT</span><span class="op">$</span><span class="va">PKcal</span>,<span class="fl">2</span><span class="op">)</span>, <span class="st">" Peta-Kcal)"</span><span class="op">)</span> <span class="op">-&gt;</span></span>
<span>  <span class="va">title</span></span>
<span><span class="fu"><a href="../reference/treemap_wrapper.html">treemap_wrapper</a></span><span class="op">(</span></span>
<span>  .DF <span class="op">=</span> <span class="va">DF_Macronutrient_FoodItem</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">region</span>, <span class="va">Food</span>, <span class="va">GCAM_commodity</span>, value <span class="op">=</span> <span class="va">MKcal</span><span class="op">)</span>,</span>
<span>  .Depth <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  .FigTitle <span class="op">=</span> <span class="va">title</span>, .FigTitleSize <span class="op">=</span> <span class="fl">18</span>,</span>
<span>  .SaveName <span class="op">=</span> <span class="st">"Fig_WorldFoodCaloriesReg"</span>,</span>
<span>  .SaveScaler <span class="op">=</span> <span class="fl">1.6</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># By commodity and region per ca per day</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Per ca. per day food calories availability by region and commodity, "</span>,</span>
<span>       <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">BaseYear</span><span class="op">)</span>, <span class="st">"-"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">BaseYear</span><span class="op">)</span>, <span class="st">" mean (world: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">WorldSTAT</span><span class="op">$</span><span class="va">PcPdKcal</span>, <span class="fl">0</span><span class="op">)</span>,<span class="st">" Kcal/ca/d)"</span><span class="op">)</span> <span class="op">-&gt;</span></span>
<span>  <span class="va">title</span></span>
<span><span class="fu"><a href="../reference/treemap_wrapper.html">treemap_wrapper</a></span><span class="op">(</span></span>
<span>  .DF <span class="op">=</span> <span class="va">DF_Macronutrient_FoodItem</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">region</span>, <span class="va">Food</span>, <span class="va">GCAM_commodity</span>, value <span class="op">=</span> <span class="va">PcPdKcal</span><span class="op">)</span>,</span>
<span>  .Depth <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  .FigTitle <span class="op">=</span> <span class="va">title</span>, .FigTitleSize <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  .SaveName <span class="op">=</span> <span class="st">"Fig_WorldFoodCaloriesRegPcPerDay"</span>,</span>
<span>  .SaveScaler <span class="op">=</span> <span class="fl">1.8</span></span>
<span><span class="op">)</span></span></code></pre></div>
<ul>
<li>Preview<br><img src="../reference/figures/Fig_WorldFoodCalories.png" style="width:20.0%"><img src="../reference/figures/Fig_WorldFoodCaloriesReg.png" style="width:20.0%"><img src="../reference/figures/Fig_WorldFoodCaloriesRegPcPerDay.png" style="width:20.0%">
</li>
</ul>
</div>
<div class="section level3">
<h3 id="trade">6. Trade<a class="anchor" aria-label="anchor" href="#trade"></a>
</h3>
<p>See <a href="https://jgcri.github.io/gcamfaostat/articles/vignette_use_cases.html#faostat-raw-data-and-processing-output-updates">Cast
Study</a> for details.</p>
</div>
<div class="section level3">
<h3 id="primary-equivalent-in-process">7. Primary equivalent [in process]<a class="anchor" aria-label="anchor" href="#primary-equivalent-in-process"></a>
</h3>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Xin Zhao, Maksym Chepeliev, Pralit Patel, Marshall Wise, Kate Calvin, Kanishka Narayan, Chris Vernon.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
