<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Use Cases • gcamfaostat</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Use Cases">
<meta property="og:description" content="gcamfaostat">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">gcamfaostat</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fas fa-book"></span>
     
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/vignette_getting_started.html">Getting Started</a>
    </li>
    <li>
      <a href="../articles/vignette_preparing_data.html">Preparing Data</a>
    </li>
    <li>
      <a href="../articles/vignette_processing_flow.html">Processing Flow</a>
    </li>
    <li>
      <a href="../articles/vignette_use_cases.html">Use Cases</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/vignette_visualization.html">
    <span class="fa fa-file-image-o"></span>
     
    Visualization
  </a>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fa fa-file-code-o"></span>
     
    Reference
  </a>
</li>
<li>
  <a href="../articles/vignette_news.html">
    <span class="fa fa-newspaper-o"></span>
     
    News
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jgcri/gcamfaostat/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Use Cases</h1>
            
            <h4 data-toc-skip class="date">2024-04-05</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/jgcri/gcamfaostat/blob/HEAD/vignettes/vignette_use_cases.Rmd" class="external-link"><code>vignettes/vignette_use_cases.Rmd</code></a></small>
      <div class="hidden name"><code>vignette_use_cases.Rmd</code></div>

    </div>

    
    
<p><strong>This page describes additional functions and capabilities of
<code>gcamfaostat</code></strong>. Users are also encouraged to check
out <code>gcamdata</code> online manual, e.g., <a href="https://jgcri.github.io/gcamdata/articles/changing-the-data-system/index.html" class="external-link">data
system changes</a> and <a href="https://jgcri.github.io/gcamdata/articles/usermod_vignette.html" class="external-link">user
modification</a> for additional examples for modifying modules.</p>
<div class="section level2">
<h2 id="faostat-raw-data-and-processing-output-updates">FAOSTAT raw data and processing output updates<a class="anchor" aria-label="anchor" href="#faostat-raw-data-and-processing-output-updates"></a>
</h2>
<p>To update the output data by including new data years, e.g., for
model base year updates, the user needs to implement the following
steps:</p>
<ol style="list-style-type: decimal">
<li>Download the latest FAOSTAT data using the
<code>FF_download_FAOSTAT</code> function.<br>
</li>
<li>In the configuration file (<code>R/constants.R</code>), adjust the
year variables and set <code>Process_Raw_FAO_Data</code> to
<code>TRUE</code>.</li>
<li>If more recent data is available the maximum year in
<code>FAOSTAT_Hist_Year_*</code> can be updated accordingly.<br>
</li>
<li>Verify and update the output formats and names in the data exporting
modules.</li>
<li>Execute the <code>driver_drake</code> function to initiate the data
processing.</li>
</ol>
</div>
<div class="section level2">
<h2 id="adding-new-data-processing-modules">Adding new data processing modules<a class="anchor" aria-label="anchor" href="#adding-new-data-processing-modules"></a>
</h2>
<p>Any R files located in the <code>R</code> folder, as long as they
adhere to the module format with clearly defined module inputs and
outputs, will be automatically detected by the driver and
<code>driver_drake</code> functions. These functions establish a data
map that dictates the sequence of data processing, ensuring that modules
are executed in the correct order. Consequently, the process of adding a
new module to the system is straightforward:</p>
<ol style="list-style-type: decimal">
<li>Create a new module script, following the examples of existing
modules.<br>
</li>
<li>Define the inputs and outputs, and incorporate your data processing
code.</li>
<li>If the module requires new datasets from FAOSTAT, include the
dataset code in <code>gcamfaostat_metadata</code> and use functions like
<code>FF_download_FAOSTAT</code> or <code>FF_rawdata_info</code> to
download the necessary data.</li>
<li>Execute the <code>driver_drake</code> function.<br>
</li>
<li>Modified <code>generate_package_data.R</code> when Prebuilt data
changes are needed.</li>
</ol>
</div>
<div class="section level2">
<h2 id="generating-output-for-new-agroeconomic-models">Generating output for new agroeconomic models<a class="anchor" aria-label="anchor" href="#generating-output-for-new-agroeconomic-models"></a>
</h2>
<p>If all the necessary FAOSTAT raw data is already incorporated into
gcamfaostat, users can directly produce output for a new agroeconomic
model. This can be achieved by either adding an output exporting module
(e.g., <code>module_xfaostat_L199_CSVExportAgSUA</code>) or adapting an
existing module (e.g., <code>module_xfaostat_L201_Forestry</code>) to
export data in the required format. Notably, gcamfaostat presently
includes a function, <code>output_csv_data</code>, for exporting data to
CSV files. Additionally, users have the flexibility to expand the
functionality by incorporating new functions to export data in
alternative formats as needed. In cases when the required data is not
readily available, users should proceed by introducing new processing
modules.</p>
<hr>
</div>
<div class="section level2">
<h2 id="country-aggregation-and-disaggregation">Country aggregation and disaggregation<a class="anchor" aria-label="anchor" href="#country-aggregation-and-disaggregation"></a>
</h2>
<p>Since the 1970s, the number of countries in the world has increased
due to the dissolution of regions. In other words, when a region
dissolves, the country associated with it ceases to exist, and new
countries emerge in its place, see <a href="FigCountryChange"><strong>Figure 1</strong></a>. We included
functions to deal with changes in the country classifications. Note the
functions rely on the <code>area_code</code> ID included in FAO dataset.
They are also consistently defined in the function.</p>
<p><a href="https://jgcri.github.io/gcamfaostat/reference/FAOSTAT_AREA_RM_NONEXIST.html"><code>FAOSTAT_AREA_RM_NONEXIST</code></a></p>
<ul>
<li>The function removes nonexistent FAO regions using area_code, e.g.,
USSR after 1991.<br>
</li>
<li>All nonexistent countries due to dissolution are removed by
default.<br>
</li>
<li>Small regions/areas with low data quality can also be removed using
this function.</li>
</ul>
<p><a href="https://jgcri.github.io/gcamfaostat/reference/FAO_AREA_DISAGGREGATE_HIST_DISSOLUTION_ALL.html"><code>FAO_AREA_DISAGGREGATE_HIST_DISSOLUTION_ALL</code></a></p>
<ul>
<li>The function disaggregates regions into smaller countries.<br>
</li>
<li>All dissolved regions (since 1970s) are disaggregated in historical
periods (before dissolution) based on the data after dissolution.</li>
</ul>
<a name="FigCountryChange"></a><br><center>
<img src="../reference/figures/Fig_CountryChanges.png" style="width:70.0%">
</center>
</div>
<div class="section level2">
<h2 id="other-helper-functions">Other helper functions<a class="anchor" aria-label="anchor" href="#other-helper-functions"></a>
</h2>
<p><a href="https://jgcri.github.io/gcamfaostat/reference/FF_FILL_NUMERATOR_DENOMINATOR.html"><code>FF_FILL_NUMERATOR_DENOMINATOR</code></a></p>
<ul>
<li>A function to fill in missing values with the consideration of the
relationship between two variables.</li>
</ul>
<p><a href="https://jgcri.github.io/gcamfaostat/reference/Moving_average.html"><code>Moving_average</code></a></p>
<ul>
<li>A function to calculate moving average given an odd number of the
periods.</li>
</ul>
<p><a href="https://jgcri.github.io/gcamfaostat/reference/rm_accent.html"><code>rm_accent</code></a></p>
<ul>
<li>A function to remove accent and apostrophe for columns in a data
frame.</li>
</ul>
<p><a href="https://jgcri.github.io/gcamfaostat/reference/rm_accent.html"><code>output_csv_data</code></a></p>
<ul>
<li>A function to save data frames to csv files with desired header
information.</li>
<li>The output can be read into gcamdata directly.</li>
</ul>
<hr>
</div>
<div class="section level2">
<h2 id="case-study-wheat-bilateral-trade-pattern-changes">Case study: wheat bilateral trade pattern changes<a class="anchor" aria-label="anchor" href="#case-study-wheat-bilateral-trade-pattern-changes"></a>
</h2>
<ul>
<li>The world wheat trade was affected by the Russian-Ukraine war in
2022 (see Figures below).</li>
<li>In 2021 vs. 2020, Russian wheat export already dropped by ~30% (+7%
for Ukraine), but plummeted another 35% (-42% for Ukraine) in 2022.</li>
<li>In the same time, USA and Canada, major wheat supplier was hit by
weather shocks and production plummeted.<br>
</li>
<li>Trade changes are certainly more complicated. The war was not the
only driver, as Canada and US also had a drop in export. But Argentina,
Australia, and even India supplied more to the world market.</li>
<li>Egypt took the largest hit. But the variation was not extreme for
most major importers. See that smile curve in China.</li>
<li>The world trade took a hit (-6%), but the overall pattern didn’t
change drastically in just 1 year.</li>
</ul>
<p><img src="../reference/figures/Fig_WheatTradeWorldby2022.png" style="width:100.0%"><img src="../reference/figures/Fig_WheatTrade2022_2021.png" style="width:100.0%"><img src="../reference/figures/Fig_WheatExportby2022.png" style="width:100.0%"><img src="../reference/figures/Fig_WheatImportby2022.png" style="width:100.0%"></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">load_all</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Download the latest TM (bilateral trade) from FAOSTAT</span></span>
<span><span class="co"># To the path specified in DIR_RAW_DATA_FAOSTAT (see constants.R)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/FF_download_FAOSTAT.html">FF_download_FAOSTAT</a></span><span class="op">(</span>DATASETCODE <span class="op">=</span> <span class="st">"TM"</span>,</span>
<span>                    DATA_FOLDER <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">".."</span>,<span class="va">DIR_RAW_DATA_FAOSTAT</span><span class="op">)</span>,</span>
<span>                    OverWrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># We could use module_xfaostat_L101_RawDataPreProc6_TM to clean and process the data</span></span>
<span><span class="co"># But here we visualize the raw data directly for continence (TM data is huge)</span></span>
<span><span class="co"># and also because the updates will be included later  </span></span>
<span></span>
<span><span class="co"># Load raw data </span></span>
<span><span class="co"># Date 10-31-2023</span></span>
<span><span class="fu"><a href="../reference/FAOSTAT_load_raw_data.html">FAOSTAT_load_raw_data</a></span><span class="op">(</span>DATASETCODE <span class="op">=</span> <span class="st">"TM"</span>, </span>
<span>                      DATA_FOLDER <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">".."</span>,<span class="va">DIR_RAW_DATA_FAOSTAT</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">TM</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2020</span><span class="op">:</span><span class="fl">2022</span><span class="op">)</span>,</span>
<span>         <span class="va">item_code</span> <span class="op">==</span> <span class="fl">15</span>, <span class="co"># Wheat</span></span>
<span>         <span class="va">element</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Export Quantity"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu">select</span><span class="op">(</span>source <span class="op">=</span> <span class="va">reporter_countries</span>,</span>
<span>           area <span class="op">=</span> <span class="va">partner_countries</span>, <span class="va">item</span>, </span>
<span>           <span class="va">element</span>, <span class="va">year</span>, <span class="va">value</span>, <span class="va">unit</span><span class="op">)</span> <span class="op">-&gt;</span></span>
<span>  <span class="va">TM_Wheat</span></span>
<span></span>
<span><span class="va">TM_Wheat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/rm_accent.html">rm_accent</a></span><span class="op">(</span><span class="st">"area"</span>, <span class="st">"source"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>value <span class="op">=</span> <span class="va">value</span> <span class="op">/</span> <span class="fl">1000000</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>  <span class="co">#Mt</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>area <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/replace.html" class="external-link">replace</a></span><span class="op">(</span><span class="va">area</span>, <span class="va">area</span> <span class="op">==</span> <span class="st">"United States of America"</span>, <span class="st">"USA"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>area <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/replace.html" class="external-link">replace</a></span><span class="op">(</span><span class="va">area</span>, <span class="va">area</span> <span class="op">==</span> <span class="st">"United Arab Emirates"</span>, <span class="st">"UAE"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>area <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/replace.html" class="external-link">replace</a></span><span class="op">(</span><span class="va">area</span>, <span class="va">area</span> <span class="op">==</span> <span class="st">"Democratic Republic of the Congo"</span>, <span class="st">"DR Congo"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>area <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">" Federation| of Great Britain and Northern Ireland| Province of| \\(Bolivarian Republic of\\)|United Republic of | \\(Islamic Republic of\\)|\\(Kingdom of the\\)"</span>, <span class="st">""</span>, <span class="va">area</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>source <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/replace.html" class="external-link">replace</a></span><span class="op">(</span><span class="va">source</span>, <span class="va">source</span> <span class="op">==</span> <span class="st">"United States of America"</span>, <span class="st">"USA"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>source <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/replace.html" class="external-link">replace</a></span><span class="op">(</span><span class="va">source</span>, <span class="va">source</span> <span class="op">==</span> <span class="st">"United Arab Emirates"</span>, <span class="st">"UAE"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>source <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/replace.html" class="external-link">replace</a></span><span class="op">(</span><span class="va">source</span>, <span class="va">source</span> <span class="op">==</span> <span class="st">"Democratic Republic of the Congo"</span>, <span class="st">"DR Congo"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>source <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">" Federation| of Great Britain and Northern Ireland| Province of| \\(Bolivarian Republic of\\)|United Republic of | \\(Islamic Republic of\\)|\\(Kingdom of the\\)"</span>, <span class="st">""</span>, <span class="va">source</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">select</span><span class="op">(</span>REG_ex <span class="op">=</span> <span class="va">source</span>, REG_im <span class="op">=</span> <span class="va">area</span>, flow <span class="op">=</span> <span class="va">value</span>, <span class="va">year</span><span class="op">)</span> <span class="op">-&gt;</span></span>
<span>  <span class="va">TM_Wheat_1</span></span>
<span></span>
<span><span class="co"># focus on key players</span></span>
<span><span class="va">TM_Wheat_1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2021</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">top_n</span><span class="op">(</span><span class="fl">35</span>, <span class="va">flow</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">REG_ex</span>, <span class="va">REG_im</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">unlist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">KeyPlayers</span></span>
<span></span>
<span><span class="va">TM_Wheat_1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>REG_ex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/replace.html" class="external-link">replace</a></span><span class="op">(</span><span class="va">REG_ex</span>, <span class="op">!</span><span class="va">REG_ex</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">KeyPlayers</span>, <span class="st">"ROW"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>REG_im <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/replace.html" class="external-link">replace</a></span><span class="op">(</span><span class="va">REG_im</span>, <span class="op">!</span><span class="va">REG_im</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">KeyPlayers</span>, <span class="st">"ROW"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># aggregate small players </span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">REG_ex</span>, <span class="va">REG_im</span>, <span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>flow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">flow</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op">-&gt;</span></span>
<span>  <span class="va">dat_circular</span></span>
<span></span>
<span><span class="va">dat_circular</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">group_by</span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">summarise</span><span class="op">(</span>flow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">flow</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jokergoo/circlize" class="external-link">circlize</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># A wrapper function</span></span>
<span><span class="va">chord_wrapper</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">.DF</span>,</span>
<span>                          <span class="va">.FigTitle</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                          <span class="va">.SaveDir</span> <span class="op">=</span> <span class="st">"../man/figures"</span>,</span>
<span>                          <span class="va">.GRIDCOLOR</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                          <span class="va">.ORDER</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                          <span class="va">.SaveName</span>,</span>
<span>                          <span class="va">.SaveScaler</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># treemap save to a path</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/grDevices/png.html" class="external-link">png</a></span><span class="op">(</span>filename<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">.SaveDir</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">.SaveName</span>,<span class="st">".png"</span><span class="op">)</span><span class="op">)</span>, res <span class="op">=</span> <span class="fl">600</span>,</span>
<span>      width<span class="op">=</span> <span class="fl">7000</span> <span class="op">*</span> <span class="va">.SaveScaler</span>, height<span class="op">=</span> <span class="fl">7000</span> <span class="op">*</span> <span class="va">.SaveScaler</span> <span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span>  <span class="fu">chordDiagram</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">.DF</span><span class="op">)</span>, </span>
<span>               transparency <span class="op">=</span> <span class="fl">0.5</span>, </span>
<span>               directional <span class="op">=</span> <span class="fl">1</span>,</span>
<span>               direction.type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"diffHeight"</span>, <span class="st">"arrows"</span><span class="op">)</span>, </span>
<span>               diffHeight <span class="op">=</span> <span class="op">-</span><span class="fu">uh</span><span class="op">(</span><span class="fl">2</span>, <span class="st">"mm"</span><span class="op">)</span></span>
<span>               ,link.arr.type <span class="op">=</span> <span class="st">"big.arrow"</span></span>
<span>               ,annotationTrack <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"grid"</span><span class="op">)</span></span>
<span>               ,grid.col <span class="op">=</span> <span class="va">.GRIDCOLOR</span></span>
<span>               ,order <span class="op">=</span> <span class="va">.ORDER</span></span>
<span>               ,preAllocateTracks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>track.height <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3</span><span class="op">)</span><span class="op">)</span></span>
<span>                                         ,<span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>track.height <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.035</span><span class="op">)</span><span class="op">)</span></span>
<span>               <span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span>main <span class="op">=</span> <span class="va">.FigTitle</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu">circos.track</span><span class="op">(</span>track.index <span class="op">=</span> <span class="fl">3</span>, panel.fun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">circos.axis</span><span class="op">(</span>h <span class="op">=</span> <span class="fl">1</span>, labels.cex <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span>   </span>
<span>  <span class="op">}</span>, bg.border <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu">circos.track</span><span class="op">(</span>track.index <span class="op">=</span> <span class="fl">1</span>, panel.fun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">xlim</span> <span class="op">=</span> <span class="fu">get.cell.meta.data</span><span class="op">(</span><span class="st">"xlim"</span><span class="op">)</span></span>
<span>    <span class="va">xplot</span> <span class="op">=</span> <span class="fu">get.cell.meta.data</span><span class="op">(</span><span class="st">"xplot"</span><span class="op">)</span></span>
<span>    <span class="va">ylim</span> <span class="op">=</span> <span class="fu">get.cell.meta.data</span><span class="op">(</span><span class="st">"ylim"</span><span class="op">)</span></span>
<span>    <span class="va">sector.name</span> <span class="op">=</span> <span class="fu">get.cell.meta.data</span><span class="op">(</span><span class="st">"sector.index"</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co">#make text label vertical when space is too small; cex to adjust font size</span></span>
<span>    </span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">xplot</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="va">xplot</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">20</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">xplot</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="va">xplot</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">340</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu">circos.text</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">xlim</span><span class="op">)</span>, <span class="va">ylim</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">sector.name</span>, facing <span class="op">=</span> <span class="st">"clockwise"</span>,</span>
<span>                  niceFacing <span class="op">=</span> <span class="cn">TRUE</span>, adj <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"black"</span>, </span>
<span>                  cex <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="fu">circos.text</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">xlim</span><span class="op">)</span>, <span class="va">ylim</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">sector.name</span>, facing <span class="op">=</span> <span class="st">"inside"</span>, </span>
<span>                  niceFacing <span class="op">=</span> <span class="cn">TRUE</span>, adj <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0</span><span class="op">)</span>, col<span class="op">=</span> <span class="st">"black"</span>, </span>
<span>                  cex <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="op">}</span>  <span class="op">}</span>, bg.border <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span> <span class="co">#dump</span></span>
<span>  </span>
<span>  <span class="fu">circos.clear</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span>  </span>
<span><span class="co"># Get color</span></span>
<span><span class="va">GridColor</span> <span class="op">&lt;-</span> <span class="fu">rand_color</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">KeyPlayers</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Plot </span></span>
<span></span>
<span><span class="fu">chord_wrapper</span><span class="op">(</span>.DF <span class="op">=</span> <span class="va">dat_circular</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2022</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">year</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">arrange</span><span class="op">(</span><span class="va">REG_ex</span>, <span class="va">REG_im</span><span class="op">)</span>,</span>
<span>              .GRIDCOLOR <span class="op">=</span> <span class="va">GridColor</span>,</span>
<span>              .FigTitle <span class="op">=</span> <span class="st">"Wheat trade, 2022"</span>,</span>
<span>              .ORDER <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">KeyPlayers</span>, <span class="st">"ROW"</span><span class="op">)</span>,</span>
<span>              .SaveDir <span class="op">=</span> <span class="st">"../man/figures"</span>,</span>
<span>              .SaveName <span class="op">=</span> <span class="st">"Fig_WheatTrade2022"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">chord_wrapper</span><span class="op">(</span>.DF <span class="op">=</span> <span class="va">dat_circular</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2021</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">year</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">arrange</span><span class="op">(</span><span class="va">REG_ex</span>, <span class="va">REG_im</span><span class="op">)</span>,</span>
<span>              .GRIDCOLOR <span class="op">=</span> <span class="va">GridColor</span>,</span>
<span>              .FigTitle <span class="op">=</span> <span class="st">"Wheat trade, 2021"</span>,</span>
<span>              .ORDER <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">KeyPlayers</span>, <span class="st">"ROW"</span><span class="op">)</span>,</span>
<span>              .SaveDir <span class="op">=</span> <span class="st">"../man/figures"</span>,</span>
<span>              .SaveName <span class="op">=</span> <span class="st">"Fig_WheatTrade2021"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">chord_wrapper</span><span class="op">(</span>.DF <span class="op">=</span> <span class="va">dat_circular</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2020</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">arrange</span><span class="op">(</span><span class="va">REG_ex</span>, <span class="va">REG_im</span><span class="op">)</span>,</span>
<span>              .GRIDCOLOR <span class="op">=</span> <span class="va">GridColor</span>,</span>
<span>              .FigTitle <span class="op">=</span> <span class="st">"Wheat trade, 2020"</span>,</span>
<span>              .ORDER <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">KeyPlayers</span>, <span class="st">"ROW"</span><span class="op">)</span>,</span>
<span>              .SaveDir <span class="op">=</span> <span class="st">"../man/figures"</span>,</span>
<span>              .SaveName <span class="op">=</span> <span class="st">"Fig_WheatTrade2020"</span><span class="op">)</span></span>
<span>    </span>
<span></span>
<span><span class="co"># Quickly adding time-series</span></span>
<span><span class="va">TM_Wheat_1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">REG_ex</span>, <span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">summarize</span><span class="op">(</span>value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">flow</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2021</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span><span class="fu">arrange</span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">top_n</span><span class="op">(</span><span class="fl">12</span>, <span class="va">value</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">REG_ex</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">KeyPlayers_exporter</span></span>
<span></span>
<span><span class="va">TM_Wheat_1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">REG_im</span>, <span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">summarize</span><span class="op">(</span>value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">flow</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2021</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span><span class="fu">arrange</span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">top_n</span><span class="op">(</span><span class="fl">12</span>, <span class="va">value</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">REG_im</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">KeyPlayers_importer</span></span>
<span></span>
<span><span class="va">TM_Wheat_1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">summarize</span><span class="op">(</span>value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">flow</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#geom_hline(yintercept = 0, size = 0.4, color = "grey") +</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1.4</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>linetype <span class="op">=</span> <span class="fl">5</span>, <span class="co">#method = "lm", </span></span>
<span>              color <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Million tonne"</span>, x <span class="op">=</span> <span class="st">"Year"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"World wheat trade, 1990 - 2022"</span>, </span>
<span>       subtitle <span class="op">=</span> <span class="st">"Observations (red solid) &amp; smooth (loess) line (black dotted) "</span>,</span>
<span>       caption <span class="op">=</span> <span class="st">"Data: FAOSTAT (2022 data may subject to updates) \n Code: JGCRI/gcamfaostat"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span>,</span>
<span>        panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>linetype <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>        axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span>,</span>
<span>        <span class="co">#axis.text.x = element_text(angle = 40, hjust = 1, vjust = 1),</span></span>
<span>        strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"grey90"</span><span class="op">)</span>,</span>
<span>        legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">p</span>;<span class="va">p</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"../man/figures"</span>, <span class="st">"Fig_WheatTradeWorldby2022.png"</span><span class="op">)</span>, <span class="va">p</span>, width <span class="op">=</span> <span class="fl">10</span>, height <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">TM_Wheat_1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">REG_ex</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">KeyPlayers_exporter</span> <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">REG_ex</span>, <span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">summarize</span><span class="op">(</span>value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">flow</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">value</span>, group <span class="op">=</span> <span class="va">REG_ex</span>, color <span class="op">=</span> <span class="va">REG_ex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">REG_ex</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, size <span class="op">=</span> <span class="fl">0.4</span>, color <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">value</span>, group <span class="op">=</span> <span class="va">REG_ex</span>, color <span class="op">=</span> <span class="va">REG_ex</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1.4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>linetype <span class="op">=</span> <span class="fl">5</span>, <span class="co">#method = "lm", </span></span>
<span>              color <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Million tonne"</span>, x <span class="op">=</span> <span class="st">"Year"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Wheat export by region (top 12 exporter), by 2022"</span>, </span>
<span>       subtitle <span class="op">=</span> <span class="st">"Observations (colored solid) &amp; smooth (loess) line (black dotted) "</span>,</span>
<span>       caption <span class="op">=</span> <span class="st">"Data: FAOSTAT \n Code: JGCRI/gcamfaostat"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span>,</span>
<span>        panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>linetype <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>        axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span>,</span>
<span>        axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">40</span>, hjust <span class="op">=</span> <span class="fl">1</span>, vjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>        strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"grey90"</span><span class="op">)</span>,</span>
<span>        legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">p</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"../man/figures"</span>, <span class="st">"Fig_WheatExportby2022.png"</span><span class="op">)</span>, <span class="va">p</span>, width <span class="op">=</span> <span class="fl">10</span>, height <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span>
<span></span>
<span><span class="va">TM_Wheat_1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">REG_im</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">KeyPlayers_importer</span> <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">REG_im</span>, <span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">summarize</span><span class="op">(</span>value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">flow</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">value</span>, group <span class="op">=</span> <span class="va">REG_im</span>, color <span class="op">=</span> <span class="va">REG_im</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">REG_im</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, size <span class="op">=</span> <span class="fl">0.4</span>, color <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">value</span>, group <span class="op">=</span> <span class="va">REG_im</span>, color <span class="op">=</span> <span class="va">REG_im</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1.4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>linetype <span class="op">=</span> <span class="fl">5</span>, <span class="co">#method = "lm", </span></span>
<span>              color <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Million tonne"</span>, x <span class="op">=</span> <span class="st">"Year"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Wheat import by region (top 12 importer), by 2022"</span>, </span>
<span>       subtitle <span class="op">=</span> <span class="st">"Observations (colored solid) &amp; smooth (loess) line (black dotted) "</span>,</span>
<span>       caption <span class="op">=</span> <span class="st">"Data: FAOSTAT \n Code: JGCRI/gcamfaostat"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span>,</span>
<span>        panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>linetype <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>        axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span>,</span>
<span>        axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">40</span>, hjust <span class="op">=</span> <span class="fl">1</span>, vjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>        strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"grey90"</span><span class="op">)</span>,</span>
<span>        legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">p</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"../man/figures"</span>, <span class="st">"Fig_WheatImportby2022.png"</span><span class="op">)</span>, <span class="va">p</span>, width <span class="op">=</span> <span class="fl">10</span>, height <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span></code></pre></div>
<ul>
<li>Preview<br><img src="../reference/figures/Fig_WheatTrade2020.png" style="width:20.0%"><img src="../reference/figures/Fig_WheatTrade2021.png" style="width:20.0%">
</li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Xin Zhao, Maksym Chepeliev, Pralit Patel, Marshall Wise, Kate Calvin, Kanishka Narayan, Chris Vernon.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
